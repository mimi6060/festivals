# ==============================================================================
# FESTIVALS BACKEND - ENVIRONMENT CONFIGURATION
# ==============================================================================
# Copy this file to .env for local development:
#   cp .env.example .env
#
# For Docker, these are typically set in docker-compose.yml or the root .env
#
# Legend:
#   [REQUIRED] - Must be set for the application to work
#   [OPTIONAL] - Has a sensible default, override if needed
#   [PRODUCTION] - Must be changed for production deployments
# ==============================================================================


# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================

# [OPTIONAL] Port the API server listens on
PORT=8080

# [REQUIRED] Environment: development, staging, production
ENVIRONMENT=development

# [OPTIONAL] Log level: debug, info, warn, error
LOG_LEVEL=info

# [OPTIONAL] Enable debug mode (verbose logging)
DEBUG=false

# [OPTIONAL] Graceful shutdown timeout
SHUTDOWN_TIMEOUT=30s


# ==============================================================================
# DATABASE (PostgreSQL)
# ==============================================================================

# [REQUIRED] PostgreSQL connection string
# Format: postgres://user:password@host:port/database?sslmode=disable
DATABASE_URL=postgres://festivals:password@localhost:5432/festivals?sslmode=disable

# [OPTIONAL] Connection pool configuration
DB_MAX_OPEN_CONNS=25
DB_MAX_IDLE_CONNS=5
DB_CONN_MAX_LIFETIME=5m

# [OPTIONAL] Enable query logging (for debugging)
DB_LOG_QUERIES=false


# ==============================================================================
# REDIS (Cache & Queue)
# ==============================================================================

# [REQUIRED] Redis connection URL
# Format: redis://[:password@]host:port[/database]
REDIS_URL=redis://localhost:6379

# [OPTIONAL] Redis connection pool size
REDIS_POOL_SIZE=10

# [OPTIONAL] Redis key prefix (useful for shared Redis instances)
REDIS_KEY_PREFIX=festivals:


# ==============================================================================
# AUTHENTICATION (Auth0)
# ==============================================================================

# [REQUIRED] Auth0 tenant domain (e.g., your-tenant.us.auth0.com)
AUTH0_DOMAIN=your-tenant.eu.auth0.com

# [REQUIRED] Auth0 API audience/identifier
AUTH0_AUDIENCE=https://api.festivals.app

# [OPTIONAL] Auth0 Management API credentials (for user operations)
AUTH0_MGMT_CLIENT_ID=your-mgmt-api-client-id
AUTH0_MGMT_CLIENT_SECRET=your-mgmt-api-client-secret


# ==============================================================================
# JWT / SECURITY
# ==============================================================================

# [PRODUCTION] Secret for signing internal JWTs (service tokens, etc.)
# Generate with: openssl rand -base64 64
JWT_SECRET=your-super-secret-key-change-in-production

# [OPTIONAL] JWT token expiration
JWT_EXPIRATION=24h

# [OPTIONAL] JWT refresh token expiration
JWT_REFRESH_EXPIRATION=168h

# [OPTIONAL] Allowed CORS origins (comma-separated)
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8081

# [OPTIONAL] Internal API key for service-to-service auth
INTERNAL_API_KEY=your-internal-api-key


# ==============================================================================
# STRIPE PAYMENTS
# ==============================================================================

# [REQUIRED] Stripe secret key (sk_test_* or sk_live_*)
STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key

# [REQUIRED] Stripe webhook signing secret (whsec_*)
# Get from: Stripe Dashboard > Developers > Webhooks > Signing secret
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-signing-secret

# [OPTIONAL] Stripe Connect settings for marketplace/platform payments
STRIPE_CONNECT_CLIENT_ID=ca_your-connect-client-id
STRIPE_CONNECT_WEBHOOK_SECRET=whsec_your-connect-webhook-secret

# [OPTIONAL] Default currency (ISO 4217)
STRIPE_DEFAULT_CURRENCY=eur

# [OPTIONAL] Platform fee percentage for Connect (0.05 = 5%)
STRIPE_PLATFORM_FEE_PERCENT=0.05


# ==============================================================================
# STORAGE (MinIO / S3)
# ==============================================================================

# [REQUIRED] MinIO/S3 endpoint (hostname:port, without protocol)
MINIO_ENDPOINT=localhost:9000

# [REQUIRED] MinIO/S3 access key
MINIO_ACCESS_KEY=minio

# [REQUIRED] MinIO/S3 secret key
MINIO_SECRET_KEY=minio123

# [REQUIRED] Default bucket for uploads
MINIO_BUCKET=festivals

# [OPTIONAL] Use SSL for MinIO connection
MINIO_USE_SSL=false

# [OPTIONAL] MinIO region (for S3 compatibility)
MINIO_REGION=us-east-1

# [OPTIONAL] Public URL for accessing uploaded files
STORAGE_PUBLIC_URL=http://localhost:9000/festivals

# [OPTIONAL] Maximum upload size in bytes (default: 50MB)
MAX_UPLOAD_SIZE=52428800


# ==============================================================================
# EMAIL SERVICE
# ==============================================================================

# [OPTIONAL] Email provider: postal, sendgrid, smtp, mailgun
EMAIL_PROVIDER=postal

# --- Postal (Self-hosted) ---
POSTAL_URL=http://localhost:5000
POSTAL_API_KEY=your-postal-api-key

# --- SendGrid ---
SENDGRID_API_KEY=SG.your-sendgrid-api-key

# --- SMTP (Generic) ---
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=your-smtp-username
SMTP_PASSWORD=your-smtp-password
SMTP_FROM_EMAIL=noreply@festivals.app
SMTP_FROM_NAME=Festivals App

# --- Mailgun ---
MAILGUN_API_KEY=your-mailgun-api-key
MAILGUN_DOMAIN=mg.festivals.app

# [OPTIONAL] Email templates directory
EMAIL_TEMPLATES_DIR=./templates/email


# ==============================================================================
# SMS SERVICE (Twilio)
# ==============================================================================

# [OPTIONAL] Twilio credentials
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your-twilio-auth-token
TWILIO_FROM_NUMBER=+1234567890

# [OPTIONAL] SMS rate limit (messages per second, 0 = unlimited)
TWILIO_RATE_LIMIT=10


# ==============================================================================
# PUSH NOTIFICATIONS
# ==============================================================================

# --- Expo Push Notifications ---
EXPO_ACCESS_TOKEN=your-expo-access-token

# --- Firebase Cloud Messaging (FCM) ---
FCM_SERVER_KEY=your-fcm-server-key
FCM_SERVICE_ACCOUNT_PATH=./config/firebase-service-account.json

# --- Apple Push Notification Service (APNs) ---
APNS_KEY_ID=your-apns-key-id
APNS_TEAM_ID=your-apple-team-id
APNS_KEY_PATH=./config/apns-auth-key.p8
APNS_BUNDLE_ID=com.festivals.app
APNS_PRODUCTION=false


# ==============================================================================
# OPENAI / AI SERVICES
# ==============================================================================

# [OPTIONAL] OpenAI API key for AI-powered features (chatbot, etc.)
OPENAI_API_KEY=sk-your-openai-api-key

# [OPTIONAL] OpenAI model for chat completions
OPENAI_MODEL=gpt-4o

# [OPTIONAL] OpenAI model for embeddings (vector search)
OPENAI_EMBED_MODEL=text-embedding-3-small


# ==============================================================================
# FEATURE FLAGS
# ==============================================================================

# Enable/disable specific features at runtime
FEATURE_NFC_PAYMENTS=true
FEATURE_WALLET_TOPUP=true
FEATURE_ARTIST_LINEUP=true
FEATURE_LIVE_CHAT=true
FEATURE_AI_CHATBOT=true
FEATURE_PUSH_NOTIFICATIONS=true
FEATURE_ANALYTICS=true


# ==============================================================================
# RATE LIMITING
# ==============================================================================

# [OPTIONAL] Enable rate limiting
RATE_LIMIT_ENABLED=true

# [OPTIONAL] Global rate limit (requests per minute per IP)
RATE_LIMIT_REQUESTS_PER_MINUTE=100

# [OPTIONAL] Auth endpoint rate limit (requests per minute per IP)
RATE_LIMIT_AUTH_PER_MINUTE=10

# [OPTIONAL] Rate limit storage: memory, redis
RATE_LIMIT_STORE=redis


# ==============================================================================
# MONITORING & OBSERVABILITY
# ==============================================================================

# --- Sentry Error Tracking ---
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1

# --- Prometheus Metrics ---
METRICS_ENABLED=true
METRICS_PORT=9090

# --- Health Checks ---
HEALTH_CHECK_ENABLED=true

# --- Request Logging ---
REQUEST_LOGGING=true
LOG_REQUEST_BODY=false
LOG_RESPONSE_BODY=false


# ==============================================================================
# BACKGROUND JOBS / WORKER
# ==============================================================================

# [OPTIONAL] Worker concurrency (number of concurrent job processors)
WORKER_CONCURRENCY=10

# [OPTIONAL] Job queue names to process (comma-separated)
WORKER_QUEUES=default,notifications,emails,payments

# [OPTIONAL] Job retry settings
JOB_MAX_RETRIES=3
JOB_RETRY_DELAY=5s


# ==============================================================================
# DEVELOPMENT / TESTING
# ==============================================================================

# [OPTIONAL] Enable hot reload (for development)
HOT_RELOAD=true

# [OPTIONAL] Test database URL
TEST_DATABASE_URL=postgres://festivals:password@localhost:5432/festivals_test?sslmode=disable

# [OPTIONAL] Seed database on startup
SEED_DATABASE=false

# [OPTIONAL] Enable pprof profiling endpoints
PPROF_ENABLED=false
